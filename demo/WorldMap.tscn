[gd_scene load_steps=13 format=2]

[ext_resource path="res://addons/DiscreteTexture/DiscreteTexture.gd" type="Script" id=1]
[ext_resource path="res://demo/HeightMap.gd" type="Script" id=2]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;


uniform sampler2D colormap : hint_albedo;
uniform float noise_min = 0.0;
uniform float noise_max = 1.0;


void fragment() {
	float noise = texture(TEXTURE, UV).r;
	noise = (noise - noise_min) / (noise_max - noise_min);
	COLOR = texture(colormap, vec2(noise, 0));
}"

[sub_resource type="Image" id=11]
data = {
"data": PoolByteArray( 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 70, 59, 119, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 75, 91, 170, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 255, 228, 119, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 59, 163, 112, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 126, 126, 142, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255, 255, 255, 235, 255 ),
"format": "RGBA8",
"height": 1,
"mipmaps": false,
"width": 256
}

[sub_resource type="ImageTexture" id=12]
flags = 0
flags = 0
image = SubResource( 11 )
size = Vector2( 256, 1 )

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 1 )
shader_param/noise_min = 0.12549
shader_param/noise_max = 0.858824
shader_param/colormap = SubResource( 12 )

[sub_resource type="OpenSimplexNoise" id=5]
period = 29.6
lacunarity = 2.95

[sub_resource type="NoiseTexture" id=6]
width = 256
height = 256
noise = SubResource( 5 )

[sub_resource type="Gradient" id=7]
offsets = PoolRealArray( 0, 0.186992, 0.553, 0.615, 0.779, 0.833333, 1 )
colors = PoolColorArray( 0.278431, 0.231373, 0.470588, 1, 0.294118, 0.356863, 0.670588, 1, 1, 0.894118, 0.470588, 1, 0.235294, 0.639216, 0.439216, 1, 0.494118, 0.494118, 0.560784, 1, 1, 1, 0.921569, 1, 1, 1, 1, 1 )

[sub_resource type="GradientTexture" id=8]
gradient = SubResource( 7 )
width = 256
script = ExtResource( 1 )

[sub_resource type="Shader" id=9]
code = "shader_type canvas_item;


uniform vec4 edge_color : hint_color;
uniform vec2 delta = vec2(1e-3);


float sobel(sampler2D tex, vec2 uv, vec2 pixel_size) {
	vec2 delta_pixel = delta * pixel_size;
	
	vec4 h = vec4(0.0);
	vec4 v = vec4(0.0);
	
	h +=       texture(tex, uv + vec2(-1.0, -1.0) * delta_pixel);
	h -=       texture(tex, uv + vec2( 0.0, -1.0) * delta_pixel);
	h += 2.0 * texture(tex, uv + vec2(-1.0,  0.0) * delta_pixel);
	h -= 2.0 * texture(tex, uv + vec2( 1.0,  0.0) * delta_pixel);
	h +=       texture(tex, uv + vec2(-1.0,  1.0) * delta_pixel);
	h -=       texture(tex, uv + vec2( 1.0,  1.0) * delta_pixel);
	
	v +=       texture(tex, uv + vec2(-1.0, -1.0) * delta_pixel);
	v += 2.0 * texture(tex, uv + vec2( 0.0, -1.0) * delta_pixel);
	v +=       texture(tex, uv + vec2( 1.0, -1.0) * delta_pixel);
	v -=       texture(tex, uv + vec2(-1.0,  1.0) * delta_pixel);
	v -= 2.0 * texture(tex, uv + vec2( 0.0,  1.0) * delta_pixel);
	v -=       texture(tex, uv + vec2( 1.0,  1.0) * delta_pixel);
	
	return sqrt(dot(h, h) + dot(v, v));
}


void fragment() {
	float s = sobel(SCREEN_TEXTURE, SCREEN_UV, SCREEN_PIXEL_SIZE);
	COLOR = texture(SCREEN_TEXTURE, SCREEN_UV);
	COLOR = mix(COLOR, edge_color, s);
}"

[sub_resource type="ShaderMaterial" id=10]
shader = SubResource( 9 )
shader_param/edge_color = Color( 0.243137, 0.223529, 0.403922, 1 )
shader_param/delta = Vector2( 0.5, 0.5 )

[node name="WorldMap" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="HeightMap" type="TextureRect" parent="."]
material = SubResource( 4 )
anchor_right = 1.0
anchor_bottom = 1.0
texture = SubResource( 6 )
stretch_mode = 1
script = ExtResource( 2 )
__meta__ = {
"_edit_use_anchors_": false
}
colormap = SubResource( 8 )

[node name="PostProcess" type="ColorRect" parent="."]
material = SubResource( 10 )
anchor_right = 1.0
anchor_bottom = 1.0
__meta__ = {
"_edit_use_anchors_": false
}
